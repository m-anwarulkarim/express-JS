/**
 * ============================================================
 * ЁЯзй Middleware тАФ Express.js ржП рж╕ржорзНржкрзВрж░рзНржг ржмрзНржпрж╛ржЦрзНржпрж╛ (Bangla Version)
 * ============================================================
 *
 * Middleware ржХрзА?
 * ----------------
 * Middleware рж╣рж▓ ржПржоржи ржПржХржЯрж┐ ржлрж╛ржВрж╢ржи ржпрж╛ request (req) ржПржмржВ response (res)
 * ржПрж░ ржорж╛ржЭрзЗ ржХрж╛ржЬ ржХрж░рзЗред Client ржпржЦржи рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯ ржкрж╛ржарж╛рзЯ, server response ржкрж╛ржарж╛ржирзЛрж░
 * ржЖржЧрзЗ ржпрзЗ рж╕ржм ржХрж╛ржЬ ржХрж░рж╛ рж╣рзЯ тАФ рж╕ржмржЗ middleware ржжрж┐рзЯрзЗ ржХрж░рж╛ ржпрж╛рзЯред
 *
 * рж╕рж╣ржЬ ржнрж╛рж╖рж╛рзЯ:
 *   Request -----> [ MIDDLEWARES ] -----> Response
 *
 * Middleware ржХрж┐ржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рзЗ?
 * ----------------------------
 * ржкрзНрж░рждрж┐ржЯрж┐ middleware function рждрж┐ржиржЯрж┐ ржкрзНржпрж╛рж░рж╛ржорж┐ржЯрж╛рж░ ржкрж╛рзЯ:
 *
 *      (req, res, next)
 *
 * тЮд req  тЖТ Client ржПрж░ ржкрж╛ржарж╛ржирзЛ request рж╕ржорзНржкрж░рзНржХрж┐ржд ржбрзЗржЯрж╛
 * тЮд res  тЖТ Server ржерзЗржХрзЗ response ржкрж╛ржарж╛ржирзЛрж░ ржорзЗржержб
 * тЮд next тЖТ Middleware ржХрзЗ ржмрж▓рзЗ тАЬржЖржорж┐ рж╢рзЗрж╖, ржкрж░рзЗрж░ржЯрж╛рж░ ржХрж╛ржЫрзЗ ржпрж╛ржУтАЭ
 *
 ** ============================================================
 * тнР ржмрж╛рж╕рзНрждржм ржЬрзАржмржирзЗрж░ ржЙржжрж╛рж╣рж░ржг (ржЖржкржирж╛рж░ ржмрзЛржЭрж╛рж░ ржЬржирзНржп)
 * ============================================================
 *
 * ЁЯОп ржЙржжрж╛рж╣рж░ржг рзз: ржирж┐рж░рж╛ржкрждрзНрждрж╛ Check (Building Gate Analogy)
 * ----------------------------------------------------
 *
 * ржзрж░рзБржи ржПржХржЯрж┐ ржмрж┐рж▓рзНржбрж┐ржВ-ржП ржкрзНрж░ржмрзЗрж╢ ржХрж░рждрзЗ ржЪрж╛ржЗ:
 *
 *   1я╕ПтГг ржЧрзЗржЯрзЗ ржПржХржЬржи рж╕рж┐ржХрж┐ржЙрж░рж┐ржЯрж┐ ржЧрж╛рж░рзНржб ржжрж╛ржБрзЬрж┐рзЯрзЗ ржЖржЫрзЗ тЖТ (Middleware)
 *   2я╕ПтГг рж╕рзЗ ржЖржкржирж╛рж░ ржЖржЗржбрж┐/ржХрж╛рж░рзНржб/ржЯрзЛржХрзЗржи ржжрзЗржЦрзЗ ржпрж╛ржЪрж╛ржЗ ржХрж░ржЫрзЗ
 *
 *      тЬФ ржпржжрж┐ ржЖржЗржбрж┐ ржарж┐ржХ ржерж╛ржХрзЗ тЖТ ржЧрж╛рж░рзНржб ржмрж▓рзЗ:
 *            "ржарж┐ржХ ржЖржЫрзЗ, ржнрзЗрждрж░рзЗ ржпрж╛ржи" тЖТ (next())
 *
 *      тЭМ ржпржжрж┐ ржЖржЗржбрж┐ ржнрзБрж▓ ржерж╛ржХрзЗ тЖТ ржЧрж╛рж░рзНржб ржмрж▓рзЗ:
 *            "ржЖржкржирж┐ ржврзБржХрждрзЗ ржкрж╛рж░ржмрзЗржи ржирж╛" тЖТ (res.send / res.status)
 *
 *
 * Express.js ржП ржПржЗ ржПржХржЗ ржХрж╛ржЬ Middleware ржХрж░рзЗ:
 *
 *    Client тЖТ [Security Middleware] тЖТ next() тЖТ Route Handler тЖТ Response
 *
 * ============================================================
 * ЁЯзй Middleware Processing Diagram (ASCII DIAGRAM)
 * ============================================================
 *
 *           тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА Request тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
 *           тФВ                                 тФВ
 *           тЦ╝                                 тФВ
 *     тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР                        тФВ
 *     тФВ Middleware 1 тФВ  app.use()             тФВ
 *     тФФтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФАтФШ                        тФВ
 *            тФВ next()                         тФВ
 *     тФМтФАтФАтФАтФАтФАтФАтЦ╝тФАтФАтФАтФАтФАтФАтФАтФАтФР                       тФВ
 *     тФВ Middleware 2   тФВ  router.use()        тФВ
 *     тФФтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФАтФАтФШ                       тФВ
 *            тФВ next()                         тФВ
 *     тФМтФАтФАтФАтФАтФАтФАтЦ╝тФАтФАтФАтФАтФАтФАтФАтФАтФР                       тФВ
 *     тФВ Route Handler  тФВ  res.send()          тФВ
 *     тФФтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФАтФАтФШ                       тФВ
 *            тФВ                                тФВ
 *            тЦ╝                                тФВ
 *         Response <тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
 *
 *
 * Middleware ржПрж░ ржХрж╛ржЬ ржХржЦржи рж╢рзЗрж╖ рж╣рзЯ?
 * -------------------------------
 * Middleware ржПрж░ ржХрж╛ржЬ ржжрзБржЗржнрж╛ржмрзЗ рж╢рзЗрж╖ рж╣рждрзЗ ржкрж╛рж░рзЗ:
 *
 * 1) next() ржХрж▓ ржХрж░рж▓рзЗ тЖТ ржкрж░рзЗрж░ middleware ржП ржпрж╛ржмрзЗ
 * 2) res.send() / res.json() / res.end() ржХрж▓ ржХрж░рж▓рзЗ тЖТ
 *    ржПржЦрж╛ржирзЗржЗ response ржкрж╛ржарж╛ржирзЛ рж╣ржмрзЗ, ржПржмржВ chain ржерзЗржорзЗ ржпрж╛ржмрзЗ
 *
 *
 * ржЙржжрж╛рж╣рж░ржг (Basic Logger Middleware)
 * ----------------------------------
 */

import express, { Request, Response, NextFunction } from "express";
const app = express();

/**
 * ЁЯУМ Example: Logging Middleware
 */
const logger = (req: Request, res: Response, next: NextFunction) => {
  console.log(`тЮбя╕П Request URL: ${req.url}`);
  next(); // ржПржЦрж╛ржирзЗ ржмрзЛржЭрж╛ржЪрзНржЫрзЗ middleware ржПрж░ ржХрж╛ржЬ рж╢рзЗрж╖, ржкрж░рзЗрж░ржЯрж┐рж░ ржжрж┐ржХрзЗ ржпрж╛ржУ
};

app.use(logger);

/**
 * ЁЯУМ Example Route (Middleware ржЪрж▓рж╛рж░ ржкрж░)
 */
app.get("/", (req: Request, res: Response) => {
  res.send("Hello from Server!");
});

/**
 * ЁЯУМ Example: Authentication Middleware (ржмрж╛рж╕рзНрждржм ржЙржжрж╛рж╣рж░ржг)
 */
const authGuard = (req: Request, res: Response, next: NextFunction) => {
  const apiKey = req.headers["x-api-key"];

  if (apiKey === "12345") {
    next(); // ржЕржирзБржорждрж┐ ржжрзЗржУрзЯрж╛ рж╣рж▓
  } else {
    res.status(401).send("Unauthorized Access"); // Middleware ржПржЦрж╛ржирзЗржЗ chain рж╢рзЗрж╖ ржХрж░рзЗ ржжрж┐ржЪрзНржЫрзЗ
  }
};

app.get("/profile", authGuard, (req: Request, res: Response) => {
  res.send("Secure User Profile");
});

/**
 * ЁЯУМ Example: Built-in Middleware
 *
 * express.json() тЖТ JSON body parse ржХрж░рзЗ
 * ржирж╛ ржжрж┐рж▓рзЗ req.body undefined ржерж╛ржХржмрзЗ
 */
app.use(express.json());

/**
 * -------------------------------------------------
 * ЁЯЪл ржХрзЛржи ржХрзЛржи ржнрзБрж▓ ржПрзЬрж┐рзЯрзЗ ржЪрж▓рж╛ ржЙржЪрж┐ржд (Best Practices)
 * -------------------------------------------------
 *
 * тЭМ рзз. next() ржнрзБрж▓рзЗ ржпрж╛ржУрзЯрж╛
 *      - middleware ржЖржЯржХрж┐рзЯрзЗ рж░рж╛ржЦржмрзЗ, response ржХржЦржирзЛ ржпрж╛ржмрзЗ ржирж╛
 *
 * тЭМ рзи. next() ржПржмржВ res.send() ржжрзБржЯрзЛржЗ ржПржХ middleware ржП ржХрж▓ ржХрж░рж╛
 *      - "Can't set headers after they are sent" error ржжрж┐ржмрзЗ
 *
 * тЭМ рзй. ржжрзАрж░рзНржШ / heavy ржХрж╛ржЬ middleware ржП ржХрж░рж╛
 *      - Server slow рж╣рзЯрзЗ ржпрж╛ржмрзЗ (auth/validate/log ржарж┐ржХ ржЖржЫрзЗ)
 *
 * тЭМ рзк. error handle ржирж╛ ржХрж░рж╛
 *
 * тЭМ рзл. middleware ржПрж░ ржнрзЗрждрж░рзЗ async error try/catch ржЫрж╛рзЬрж╛ ржмрзНржпржмрж╣рж╛рж░
 *
 *
 * -------------------------------------------------
 * ЁЯОЙ Final Note:
 * -------------------------------------------------
 *
 * Middleware рж╣рж▓рзЛ Express.js ржПрж░ рж╕ржмржЪрзЗрзЯрзЗ рж╢ржХрзНрждрж┐рж╢рж╛рж▓рзА ржЕржВрж╢ред
 * рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯ ржПрж▓рзЛ тЖТ ржмрж┐ржнрж┐ржирзНржи ржЪрзЗржХ тЖТ validation тЖТ security тЖТ logging тЖТ response
 * рж╕ржмржХрж┐ржЫрзБ chain ржЖржХрж╛рж░рзЗ control ржХрж░рж╛ ржпрж╛рзЯред
 *
 */
