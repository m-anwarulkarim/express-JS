/**
 * ===============================================
 * req.protocol тАУ ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд ржмрзНржпрж╛ржЦрзНржпрж╛
 * ===============================================
 *
 * 1я╕ПтГг ржХрзАржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рзЗ:
 * -------------------
 * - `req.protocol` рж╣рж▓рзЛ Express.js request object ржПрж░ ржПржХржЯрж┐ propertyред
 * - ржПржЯрж┐ client request ржХрзЛржи **protocol** ржжрж┐рзЯрзЗ ржПрж╕рзЗржЫрзЗ рждрж╛ return ржХрж░рзЗ:
 *    - HTTP тЖТ "http"
 *    - HTTPS тЖТ "https"
 * - Proxy ржмрж╛ load balancer ржерж╛ржХрж▓рзЗ, `trust proxy` рж╕рзЗржЯ ржХрж░рж▓рзЗ ржПржЯрж┐ `X-Forwarded-Proto` header ржерзЗржХрзЗ check ржХрж░рзЗред
 *
 * ржЙржжрж╛рж╣рж░ржг:
 * -------------------
 * http://example.com тЖТ req.protocol = "http"
 * https://example.com тЖТ req.protocol = "https"
 *
 * -----------------------------------------------
 * 2я╕ПтГг ржмрзНржпржмрж╣рж╛рж░ ржЙржжрж╛рж╣рж░ржг
 * -----------------------------------------------
 */

import express, { Request, Response } from "express";

const app = express();

app.get("/", (req: Request, res: Response) => {
  res.send(`Request protocol is: ${req.protocol}`);
});

// -----------------------------------------------
/**
 * ===============================================
 * req.ip тАУ ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд ржмрзНржпрж╛ржЦрзНржпрж╛
 * ===============================================
 *
 * 1я╕ПтГг ржХрзАржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рзЗ:
 * -------------------
 * - `req.ip` рж╣рж▓рзЛ Express.js request object ржПрж░ ржПржХржЯрж┐ propertyред
 * - ржПржЯрж┐ client ржпрзЗ **IP address** ржерзЗржХрзЗ request ржкрж╛ржарж┐рзЯрзЗржЫрзЗ рждрж╛ return ржХрж░рзЗред
 * - Proxy ржмрж╛ load balancer ржерж╛ржХрж▓рзЗ, `trust proxy` рж╕рзЗржЯ ржХрж░рж▓рзЗ ржПржЯрж┐ `X-Forwarded-For` header ржерзЗржХрзЗ ржЖрж╕рж▓ IP ржирзЗржмрзЗред
 *
 * ржЙржжрж╛рж╣рж░ржг:
 * -------------------
 * рж╕рж░рж╛рж╕рж░рж┐ local machine тЖТ req.ip = "::1" (IPv6) ржмрж╛ "127.0.0.1" (IPv4)
 * Internet ржерзЗржХрзЗ тЖТ req.ip = client ржПрж░ public IP
 *
 * -----------------------------------------------
 * 2я╕ПтГг ржмрзНржпржмрж╣рж╛рж░ ржЙржжрж╛рж╣рж░ржг
 * -----------------------------------------------
 */

app.get("/ip", (req: Request, res: Response) => {
  res.send(`Client IP address: ${req.ip}`);
});

// -----------------------------------------------
/**
 * ЁЯФО рж╕рж╣ржЬ ржХржерж╛рзЯ:
 * -----------------
 * - req.protocol тЖТ HTTP ржмрж╛ HTTPS
 * - req.ip тЖТ Client ржПрж░ IP address
 *
 * -----------------------------------------------
 * ЁЯФО Common Uses:
 * -----------------
 * 1) req.protocol
 *    - Redirect HTTP тЖТ HTTPS
 *    - Logging / security
 *
 * 2) req.ip
 *    - IP-based access control
 *    - Logging / analytics
 *    - Rate-limiting
 *
 * -----------------------------------------------
 * ЁЯФО Common Mistakes:
 * -----------------
 * 1) Proxy / load balancer ржерж╛ржХрж▓рзЗ trust proxy ржирж╛ set ржХрж░рж╛ тЖТ ржнрзБрж▓ protocol ржмрж╛ IP ржкрж╛ржУржпрж╝рж╛
 * 2) req.ip expect ржХрж░рж╛ IPv4 only тЖТ IPv6 ржмрж╛ "::1" ржЖрж╕рждрзЗ ржкрж╛рж░рзЗ
 *
 * -----------------------------------------------
 * ЁЯФО рж╢рж┐ржЦрж╛рж░ ржорзВрж▓ ржХржерж╛:
 * -----------------
 * - Protocol ржмрж╛ client IP ржЬрж╛ржирждрзЗ req.protocol ржУ req.ip ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЛ
 * - Security, logging, redirect, analytics рж╕ржмржХрж┐ржЫрзБрждрзЗ ржХрж╛ржЬрзЗ ржЖрж╕рзЗ
 */
